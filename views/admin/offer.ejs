<%-include("../partials/adheader.ejs")-%>
<style>
    .filter-section {
  margin-bottom: 20px;
}

.filter-section label {
  margin-right: 10px;
}

.filter-section button {
  margin-left: 10px;
}

</style>
<nav>
    <ul class="menu-aside">
        <li class="menu-item active">
            <a class="menu-link" href="/admin/dashboard"> <i class="icon material-icons md-home"></i>
                <span class="text">ADMIN HOME</span>
            </a>
        </li>
        <li class="menu-item has-submenu ">
            <a class="menu-link"> <i class="icon material-icons md-shopping_bag"></i>
                <span class="text">Products</span>
            </a>
            <div class="submenu">
                <a href="/admin/addproduct">Add Product</a>
                <a href="/admin/productlist">Product List</a>


            </div>
            </li>
        <li class="menu-item ">
            <a class="menu-link" href="/admin/orders"> <i class="icon material-icons md-shopping_cart"></i>
                <span class="text">Orders</span>
            </a>

        </li>
        <li class="menu-item ">
            <a class="menu-link" href="/admin/banner"> <i class="icon material-icons md-shopping_cart"></i>
                <span class="text">Banner</span>
            </a>

        </li>
        <li class="menu-item ">
            <a class="menu-link" href="/admin/categorydisplay"> <i
                    class="icon material-icons md-shopping_cart"></i>
                <span class="text">Category</span>
            </a>

        </li>
    </li>
    <li class="menu-item has-submenu">
        <a class="menu-link" href="#" ><i class="icon material-icons md-local_offer"></i>
            <span class="text">Coupon</span>
        </a>
        <div class="submenu">
            <a href="/admin/couponList">Coupon List</a>
            <a href="/admin/addcoupon">Add Coupon</a>
        </div>
    </li>
        <li class="menu-item has-submenu">
            <a class="menu-link" href=""> <i class="icon material-icons md-store"></i>
                <span class="text">Users</span>
            </a>
            <div class="submenu">
                <a href="/admin/users">UserList</a>

            </div>

        </li>
        

        <li class="menu-item has-submenu">
            <a class="menu-link" href="#"> <i class="icon material-icons md-person"></i>
                <span class="text">Account</span>
            </a>
            <div class="submenu">
                <a href="/admin">User login</a>
                <a href="/admin/adregister">User registration</a>
                <a href="/admin/error">Error 404</a>
            </div>
        </li>
        <li class="menu-item has-submenu active">
            <a class="menu-link" href="page-products-list.html"> <i class="icon material-icons md-shopping_bag"></i>
                <span class="text">Offers</span>
            </a>
            <div class="submenu">
                <a href="/admin/offer" class="active">Product Offer</a>
                <!-- <a href="/admin/categoryOffer">Category Offer</a> -->
            </div>
        </li>



    </ul>
    <hr>
    <ul class="menu-aside">
        <li class="menu-item has-submenu">
            <a class="menu-link" href="#"> <i class="icon material-icons md-settings"></i>
                <span class="text">Settings</span>
            </a>
            <div class="submenu">
                <a href="page-settings-1.html">Setting sample 1</a>
                <a href="page-settings-2.html">Setting sample 2</a>
            </div>
        </li>

    </ul>
    <br>
    <br>
</nav>
   
 </aside>
 <main class="main-wrap">


    <section class="content-main">
        <div class="content-header">
            <div>
                <h2 class="content-title card-title">Product Offers</h2>
                <p></p>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <form action="/admin/offer" method="POST">
                            <div class="mb-4">
                                <label for="category_name" class="form-label">Product Name</label>
                                <select name="productName" class="form-select">
                                    <%products.forEach(function(product){%>
                                        <option><%=product.productName%></option>
                                    <%})%>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="form-label">Offer Percentage</label>
                                <select name="offerpercentage" class="form-select">
                                    <option>10</option>
                                    <option>20</option>
                                    <option>30</option>
                                    <option>40</option>
                                    <option>50</option>
                                </select>
                            </div>
                            <!-- <div class="mb-4">
                                <label class="form-label">Expiry</label>
                                <input placeholder="" type="date" name="expireDate" class="form-control">
                            </div> -->
                            <div class="d-grid">
                                <button class="btn btn-primary">Create Offer</button>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-9">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th class="text-center">
                                            <!-- <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" />
                                            </div> -->
                                        </th>
                                        <th>Name</th>
                                        <th>Offer Percentage</th>
                                        <th>Actual Price</th>
                                        <th>Offer Price</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <%offered.forEach(function(product){%>
                                <tbody>
                                    <tr>
                                        <td class="text-center">
                                            <!-- <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" />
                                            </div> -->
                                        </td>
                                        <td><%=product.productName%></td>
                                        <td><%=product.offerpercentage%>%</td>
                                        <td>₹<%=product.price%></td>
                                        <td>₹<%=product.offerprice%></td>
                                        <td>
                                            <a href="#" data-id="<%=product._id%>"  class="btn btn-danger removeoffer">Remove</a>
                                        </td>
                                    </tr>
                                </tbody>
                                <%})%>
                            </table>
                        </div>
                    </div> <!-- .col// -->
                </div> <!-- .row // -->
            </div> <!-- card body .// -->
        </div> <!-- card .// -->
    </section> <!-- content-main end// -->
<script src="https://code.jquery.com/jquery-3.6.4.slim.js"
integrity="sha256-dWvV84T6BhzO4vG6gWhsWVKVoa4lVmLnpBOZh/CAHU4=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.js"></script>

<%-include("../partials/adfooter.ejs")-%>


<script>
    $('.removeoffer').on('click',function(){
        console.log("clicked");
        let id = $(this).data('id');
        data={ id };
        Swal.fire({
            title: "Are you sure?",
            text: "This action can't undone.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes'
        }).then((result)=>{
            if(result.isConfirmed) {
                $.ajax({
                    url: '/admin/removeProductOffer',
                    method: 'POST',
                    data: data,
                    success: function(response){
                        if(response.message == '1'){
                            Swal.fire({
                                title: 'Success',
                                text: "Product Offer Removed",
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then((result)=>{
                                if(result.isConfirmed) {
                                    location.reload();
                                }
                            });
                        } else {
                            Swal.fire({
                                title: 'Error',
                                text: 'Something went wrong',
                                icon: 'error',
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Yes'
                            });
                        }
                    }
                });
            }
        });
    });
</script>